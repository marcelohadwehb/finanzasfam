<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Familiares</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase Libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp, doc, updateDoc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        setLogLevel('debug');
        
        let db;
        let auth;
        let userId;

        // Variables de configuración proporcionadas por el entorno
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const ingresosData = [];
        const gastosData = [];

        // Definición de categorías y subcategorías
        const categoriasGastos = [
            { categoria: 'Fijos del hogar', subcategorias: ['Dividendo', 'Luz', 'Agua', 'Gas', 'Teléfono / Internet', 'Gastos comunes'] },
            { categoria: 'Servicios de streaming', subcategorias: ['Netflix', 'Spotify', 'Amazon Prime', 'HBO', 'Otros'] },
            { categoria: 'Salud', subcategorias: ['ISAPRE', 'Clínica', 'Dentista', 'Medicinas'] },
            { categoria: 'Educación', subcategorias: ['Colegio', 'Universidad', 'Cursos'] },
            { categoria: 'Alimentación', subcategorias: ['Supermercado', 'Restaurantes', 'Delivery'] },
            { categoria: 'Transporte', subcategorias: ['Bencina / Combustible', 'Pasajes', 'Mantención vehículo'] },
            { categoria: 'Vestuario', subcategorias: ['Ropa', 'Zapatos', 'Accesorios'] },
            { categoria: 'Ocio y entretención', subcategorias: ['Cine', 'Viajes', 'Pasatiempos'] },
            { categoria: 'Varios', subcategorias: ['Otros'] }
        ];

        // Definición de categorías de ingresos
        const categoriasIngresos = ['Sueldo', 'Ventas', 'Bonos', 'Inversiones', 'Otros'];

        // Manejo del estado de la aplicación
        let editing = { isEditing: false, docId: null, type: null };
        const confirmAction = { resolve: null };
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1; // getMonth() es 0-index

        // Funciones de utilidad
        const getFormattedDate = (timestamp) => {
            const date = timestamp instanceof Date ? timestamp : timestamp.toDate();
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        const renderBalances = () => {
            const balancesTable = document.getElementById('balancesTable');
            balancesTable.innerHTML = '';
            
            const filteredIngresos = ingresosData.filter(item => {
                const date = item.fecha.toDate();
                return date.getFullYear() === currentYear && (currentMonth === 'all' || date.getMonth() + 1 === currentMonth);
            });

            const filteredGastos = gastosData.filter(item => {
                const date = item.fecha.toDate();
                return date.getFullYear() === currentYear && (currentMonth === 'all' || date.getMonth() + 1 === currentMonth);
            });
            
            const totalIngresos = filteredIngresos.reduce((sum, item) => sum + item.monto, 0);
            const totalGastos = filteredGastos.reduce((sum, item) => sum + item.monto, 0);
            const balanceTotal = totalIngresos - totalGastos;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="py-2 px-4 border-b text-green-600 font-semibold">${totalIngresos.toLocaleString('es-CL', { style: 'currency', currency: 'CLP' })}</td>
                <td class="py-2 px-4 border-b text-red-600 font-semibold">${totalGastos.toLocaleString('es-CL', { style: 'currency', currency: 'CLP' })}</td>
                <td class="py-2 px-4 border-b font-bold ${balanceTotal >= 0 ? 'text-green-600' : 'text-red-600'}">${balanceTotal.toLocaleString('es-CL', { style: 'currency', currency: 'CLP' })}</td>
            `;
            balancesTable.appendChild(row);
        };

        const renderPresupuesto = () => {
            const presupuestoTable = document.getElementById('presupuestoTable');
            presupuestoTable.innerHTML = '';

            const filteredGastos = gastosData.filter(item => {
                const date = item.fecha.toDate();
                return date.getFullYear() === currentYear && (currentMonth === 'all' || date.getMonth() + 1 === currentMonth);
            });

            const gastosPorCategoria = filteredGastos.reduce((acc, gasto) => {
                const categoria = gasto.categoria || 'Sin categoría';
                acc[categoria] = (acc[categoria] || 0) + gasto.monto;
                return acc;
            }, {});

            for (const categoria in gastosPorCategoria) {
                const total = gastosPorCategoria[categoria];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${categoria}</td>
                    <td class="py-2 px-4 border-b">${total.toLocaleString('es-CL', { style: 'currency', currency: 'CLP' })}</td>
                `;
                presupuestoTable.appendChild(row);
            }
        };

        const renderRegistros = () => {
            renderBalances();
            renderPresupuesto();
        };

        const populateSelect = (selectElement, options, includeEmpty = true) => {
            selectElement.innerHTML = '';
            if (includeEmpty) {
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = 'Selecciona una categoría';
                emptyOption.disabled = true;
                emptyOption.selected = true;
                selectElement.appendChild(emptyOption);
            }
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = opt.textContent = option;
                selectElement.appendChild(opt);
            });
        };

        const populateCategorias = () => {
            const categoriaGastoSelect = document.getElementById('gastoCategoria');
            populateSelect(categoriaGastoSelect, categoriasGastos.map(c => c.categoria), false);
            categoriaGastoSelect.value = categoriasGastos[0].categoria;
            populateSubcategorias();

            const categoriaIngresoSelect = document.getElementById('ingresoCategoria');
            populateSelect(categoriaIngresoSelect, categoriasIngresos, false);
            categoriaIngresoSelect.value = categoriasIngresos[0];
        };

        const populateSubcategorias = () => {
            const categoriaSelect = document.getElementById('gastoCategoria');
            const subcategoriaSelect = document.getElementById('gastoSubcategoria');
            const selectedCategoria = categoriasGastos.find(c => c.categoria === categoriaSelect.value);

            if (selectedCategoria) {
                populateSelect(subcategoriaSelect, selectedCategoria.subcategorias);
            } else {
                subcategoriaSelect.innerHTML = '<option value="">Selecciona una subcategoría</option>';
            }
        };

        const showModal = (message, onConfirm) => {
            const modal = document.getElementById('confirmModal');
            const modalMessage = document.getElementById('modalMessage');
            modalMessage.textContent = message;
            modal.classList.remove('hidden');

            return new Promise(resolve => {
                confirmAction.resolve = resolve;
                const confirmBtn = document.getElementById('confirmBtn');
                const cancelBtn = document.getElementById('cancelBtn');
                
                const handleConfirm = () => {
                    modal.classList.add('hidden');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(true);
                };
                
                const handleCancel = () => {
                    modal.classList.add('hidden');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(false);
                };
                
                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
            });
        };

        const showMessage = (message, isError = false) => {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.className = `p-3 rounded-lg text-center font-semibold mb-4 transition-all duration-300 ${isError ? 'bg-red-200 text-red-800' : 'bg-green-200 text-green-800'}`;
            messageBox.classList.remove('hidden');
            setTimeout(() => messageBox.classList.add('hidden'), 5000);
        };

        const getMonthName = (monthNumber) => {
            const date = new Date();
            date.setMonth(monthNumber - 1);
            return date.toLocaleString('es-ES', { month: 'long' });
        };

        const populateYearAndMonthSelectors = () => {
            const yearSelect = document.getElementById('yearSelector');
            const monthSelect = document.getElementById('monthSelector');
            const currentYear = new Date().getFullYear();
            
            // Populate years
            yearSelect.innerHTML = '';
            for (let i = currentYear; i <= 2060; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelect.appendChild(option);
            }
            yearSelect.value = currentYear;
            
            // Populate months
            monthSelect.innerHTML = '<option value="all">Todos los meses</option>';
            for (let i = 1; i <= 12; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = getMonthName(i);
                monthSelect.appendChild(option);
            }
            monthSelect.value = new Date().getMonth() + 1;
        };
        
        // Manejadores de eventos
        const handleAddOrEdit = async (event, type) => {
            event.preventDefault();
            const form = event.target;
            const fecha = form.querySelector('input[type="date"]').value;
            const descripcion = form.querySelector('input[type="text"]').value;
            const monto = parseFloat(form.querySelector('input[type="number"]').value);
            const categoria = form.querySelector('select:first-of-type').value;
            const subcategoria = form.querySelector('select:last-of-type').value;
            
            if (!fecha || !descripcion || isNaN(monto) || monto <= 0) {
                showMessage('Por favor, completa todos los campos correctamente.', true);
                return;
            }
            
            const data = {
                fecha: new Date(fecha),
                descripcion,
                monto,
                categoria,
                ...(type === 'gasto' && { subcategoria }),
                timestamp: serverTimestamp()
            };
            
            try {
                if (editing.isEditing && editing.type === type) {
                    const docRef = doc(db, `artifacts/${appId}/users/${userId}/${type}s`, editing.docId);
                    await updateDoc(docRef, data);
                    showMessage(`Registro de ${type} actualizado exitosamente.`);
                    editing = { isEditing: false, docId: null, type: null };
                    form.reset();
                    document.getElementById(`${type}SubmitBtn`).textContent = `Añadir ${type.charAt(0).toUpperCase() + type.slice(1)}`;
                    document.getElementById(`${type}CancelBtn`).classList.add('hidden');
                } else {
                    await addDoc(collection(db, `artifacts/${appId}/users/${userId}/${type}s`), data);
                    showMessage(`Registro de ${type} añadido exitosamente.`);
                    form.reset();
                }
            } catch (e) {
                console.error("Error al añadir/editar documento: ", e);
                showMessage('Error al guardar el registro. Revisa la consola para más detalles.', true);
            }
        };

        const handleEdit = (docId, type) => {
            const data = type === 'ingreso' ? ingresosData.find(d => d.id === docId) : gastosData.find(d => d.id === docId);
            if (!data) return;
            
            editing = { isEditing: true, docId, type };
            
            const form = document.getElementById(`${type}Form`);
            form.querySelector('input[type="date"]').value = data.fecha.toDate().toISOString().split('T')[0];
            form.querySelector('input[type="text"]').value = data.descripcion;
            form.querySelector('input[type="number"]').value = data.monto;
            
            // Set select values
            const categoriaSelect = form.querySelector('select:first-of-type');
            categoriaSelect.value = data.categoria;
            
            if (type === 'gasto') {
                populateSubcategorias();
                const subcategoriaSelect = form.querySelector('select:last-of-type');
                subcategoriaSelect.value = data.subcategoria;
            }
            
            document.getElementById(`${type}SubmitBtn`).textContent = `Guardar Cambios`;
            document.getElementById(`${type}CancelBtn`).classList.remove('hidden');
        };

        const handleDelete = async (docId, type) => {
            const confirmed = await showModal('¿Estás seguro de que quieres eliminar este registro?');
            if (confirmed) {
                try {
                    await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/${type}s`, docId));
                    showMessage(`Registro de ${type} eliminado exitosamente.`);
                } catch (e) {
                    console.error("Error al eliminar documento: ", e);
                    showMessage('Error al eliminar el registro. Revisa la consola para más detalles.', true);
                }
            }
        };

        const renderItems = (data, listId, type) => {
            const list = document.getElementById(listId);
            list.innerHTML = '';
            const filteredData = data.filter(item => {
                const date = item.fecha.toDate();
                return date.getFullYear() === currentYear && (currentMonth === 'all' || date.getMonth() + 1 === currentMonth);
            }).sort((a, b) => b.fecha.toDate() - a.fecha.toDate());

            if (filteredData.length === 0) {
                list.innerHTML = `<p class="text-center text-gray-500 py-4">No hay ${type}s registrados para este período.</p>`;
                return;
            }

            const table = document.createElement('table');
            table.className = "min-w-full bg-white rounded-lg shadow-md";
            const head = document.createElement('thead');
            head.innerHTML = `
                <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                    <th class="py-3 px-6 text-left">Fecha</th>
                    <th class="py-3 px-6 text-left">Descripción / Categoría</th>
                    <th class="py-3 px-6 text-left">Monto</th>
                    <th class="py-3 px-6 text-center">Acciones</th>
                </tr>
            `;
            table.appendChild(head);
            
            const body = document.createElement('tbody');
            body.className = "text-gray-600 text-sm font-light";
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                row.className = "border-b border-gray-200 hover:bg-gray-100";
                row.innerHTML = `
                    <td class="py-3 px-6 text-left whitespace-nowrap">${getFormattedDate(item.fecha)}</td>
                    <td class="py-3 px-6 text-left">${item.descripcion || item.categoria}</td>
                    <td class="py-3 px-6 text-left font-semibold ${type === 'ingreso' ? 'text-green-600' : 'text-red-600'}">${item.monto.toLocaleString('es-CL', { style: 'currency', currency: 'CLP' })}</td>
                    <td class="py-3 px-6 text-center">
                        <div class="flex item-center justify-center space-x-2">
                            <button class="w-6 h-6 transform hover:text-purple-500 hover:scale-110" onclick="handleEdit('${item.id}', '${type}')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-full h-full">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                </svg>
                            </button>
                            <button class="w-6 h-6 transform hover:text-red-500 hover:scale-110" onclick="handleDelete('${item.id}', '${type}')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-full h-full">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.013 21H7.987a2 2 0 01-1.922-2.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
                body.appendChild(row);
            });
            table.appendChild(body);
            list.appendChild(table);
        };

        const exportToCsv = (data, filename) => {
            const csvRows = [];
            const headers = Object.keys(data[0] || {});
            csvRows.push(headers.join(','));

            for (const row of data) {
                const values = headers.map(header => {
                    const val = row[header];
                    if (val instanceof Date) {
                        return val.toISOString().split('T')[0];
                    }
                    if (typeof val === 'string' && val.includes(',')) {
                        return `"${val}"`;
                    }
                    return val;
                });
                csvRows.push(values.join(','));
            }
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', filename);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };
        
        // Inicialización y Listeners
        window.onload = () => {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        
                        // Listeners de Firestore
                        const ingresosQuery = query(collection(db, `artifacts/${appId}/users/${userId}/ingresos`));
                        onSnapshot(ingresosQuery, (snapshot) => {
                            ingresosData.length = 0;
                            snapshot.docs.forEach(doc => {
                                ingresosData.push({ id: doc.id, ...doc.data() });
                            });
                            renderRegistros();
                            renderItems(ingresosData, 'ingresosList', 'ingreso');
                        });

                        const gastosQuery = query(collection(db, `artifacts/${appId}/users/${userId}/gastos`));
                        onSnapshot(gastosQuery, (snapshot) => {
                            gastosData.length = 0;
                            snapshot.docs.forEach(doc => {
                                gastosData.push({ id: doc.id, ...doc.data() });
                            });
                            renderRegistros();
                            renderItems(gastosData, 'gastosList', 'gasto');
                        });

                    } else {
                        // Iniciar sesión anónimamente si no hay token de autenticación
                        if (initialAuthToken) {
                            try {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } catch (e) {
                                console.error("Error signing in with custom token: ", e);
                                await signInAnonymously(auth);
                            }
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });
            } catch (e) {
                console.error("Firebase initialization failed: ", e);
                const rootDiv = document.getElementById('root');
                rootDiv.innerHTML = '<div class="flex items-center justify-center min-h-screen text-lg font-bold text-red-600">Error: No se pudo inicializar Firebase. Revisa la consola para más detalles.</div>';
            }

            // Event Listeners para formularios
            document.getElementById('ingresoForm').addEventListener('submit', (e) => handleAddOrEdit(e, 'ingreso'));
            document.getElementById('gastoForm').addEventListener('submit', (e) => handleAddOrEdit(e, 'gasto'));
            document.getElementById('gastoCategoria').addEventListener('change', populateSubcategorias);

            // Event Listeners para botones de cancelación de edición
            document.getElementById('ingresoCancelBtn').addEventListener('click', () => {
                editing = { isEditing: false, docId: null, type: null };
                document.getElementById('ingresoForm').reset();
                document.getElementById('ingresoSubmitBtn').textContent = 'Añadir Ingreso';
                document.getElementById('ingresoCancelBtn').classList.add('hidden');
            });
            document.getElementById('gastoCancelBtn').addEventListener('click', () => {
                editing = { isEditing: false, docId: null, type: null };
                document.getElementById('gastoForm').reset();
                document.getElementById('gastoSubmitBtn').textContent = 'Añadir Gasto';
                document.getElementById('gastoCancelBtn').classList.add('hidden');
            });

            // Event Listeners para exportar
            document.getElementById('exportIngresos').addEventListener('click', () => exportToCsv(ingresosData, 'ingresos.csv'));
            document.getElementById('exportGastos').addEventListener('click', () => exportToCsv(gastosData, 'gastos.csv'));

            // Event Listeners para selectores de año y mes
            document.getElementById('yearSelector').addEventListener('change', (e) => {
                currentYear = parseInt(e.target.value, 10);
                renderRegistros();
                renderItems(ingresosData, 'ingresosList', 'ingreso');
                renderItems(gastosData, 'gastosList', 'gasto');
            });

            document.getElementById('monthSelector').addEventListener('change', (e) => {
                currentMonth = e.target.value === 'all' ? 'all' : parseInt(e.target.value, 10);
                renderRegistros();
                renderItems(ingresosData, 'ingresosList', 'ingreso');
                renderItems(gastosData, 'gastosList', 'gasto');
            });

            // Llenar selectores al cargar la página
            populateYearAndMonthSelectors();
            populateCategorias();
        };

        // Exponer funciones globales para el uso en el HTML (onclick)
        window.handleEdit = handleEdit;
        window.handleDelete = handleDelete;
    </script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
    <div id="root" class="min-h-screen">
        <div class="container mx-auto p-4 md:p-8">
            <header class="text-center mb-8">
                <h1 class="text-4xl font-extrabold text-gray-800">Control de Finanzas Familiares</h1>
            </header>
            
            <div id="messageBox" class="hidden"></div>
            
            <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Columna 1: Balance General y Presupuesto -->
                <section class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-xl flex flex-col items-center">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Resumen Financiero</h2>
                    <div class="w-full flex flex-col sm:flex-row lg:flex-col gap-4 mb-4">
                        <div class="w-full sm:w-1/2 lg:w-full bg-green-100 p-4 rounded-xl shadow-inner flex flex-col items-center">
                            <h3 class="text-lg font-semibold text-green-700">Ingresos Totales</h3>
                            <p class="text-3xl font-extrabold text-green-600" id="totalIngresosDisplay">$0</p>
                        </div>
                        <div class="w-full sm:w-1/2 lg:w-full bg-red-100 p-4 rounded-xl shadow-inner flex flex-col items-center">
                            <h3 class="text-lg font-semibold text-red-700">Gastos Totales</h3>
                            <p class="text-3xl font-extrabold text-red-600" id="totalGastosDisplay">$0</p>
                        </div>
                    </div>

                    <div class="flex space-x-2 mb-6">
                        <select id="yearSelector" class="p-2 border rounded-lg"></select>
                        <select id="monthSelector" class="p-2 border rounded-lg"></select>
                    </div>

                    <h3 class="text-xl font-bold mb-2 text-gray-800">Balance General</h3>
                    <div class="overflow-x-auto w-full mb-6">
                        <table class="min-w-full bg-gray-50 rounded-lg shadow-inner">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th class="py-2 px-4 text-left font-bold text-green-700">Ingresos</th>
                                    <th class="py-2 px-4 text-left font-bold text-red-700">Gastos</th>
                                    <th class="py-2 px-4 text-left font-bold text-gray-700">Balance</th>
                                </tr>
                            </thead>
                            <tbody id="balancesTable"></tbody>
                        </table>
                    </div>

                    <h3 class="text-xl font-bold mb-2 text-gray-800">Presupuesto por Categoría</h3>
                    <div class="overflow-x-auto w-full">
                        <table class="min-w-full bg-gray-50 rounded-lg shadow-inner">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th class="py-2 px-4 text-left font-bold text-gray-700">Categoría</th>
                                    <th class="py-2 px-4 text-left font-bold text-gray-700">Monto</th>
                                </tr>
                            </thead>
                            <tbody id="presupuestoTable"></tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Columna 2: Ingresos y Gastos -->
                <section class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Ingresos -->
                    <div class="bg-white p-6 rounded-2xl shadow-xl">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">Registro de Ingresos</h2>
                        <form id="ingresoForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="lg:col-span-2">
                                <label for="ingresoFecha" class="block text-sm font-semibold text-gray-700">Fecha</label>
                                <input type="date" id="ingresoFecha" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-green-300 focus:border-green-500 transition-colors">
                            </div>
                            <div class="lg:col-span-2">
                                <label for="ingresoMonto" class="block text-sm font-semibold text-gray-700">Monto</label>
                                <input type="number" id="ingresoMonto" placeholder="Ej: 50000" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-green-300 focus:border-green-500 transition-colors">
                            </div>
                            <div class="lg:col-span-2">
                                <label for="ingresoCategoria" class="block text-sm font-semibold text-gray-700">Categoría</label>
                                <select id="ingresoCategoria" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-green-300 focus:border-green-500 transition-colors"></select>
                            </div>
                            <div class="lg:col-span-2">
                                <label for="ingresoDescripcion" class="block text-sm font-semibold text-gray-700">Descripción</label>
                                <input type="text" id="ingresoDescripcion" placeholder="Ej: Venta de producto" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-green-300 focus:border-green-500 transition-colors">
                            </div>
                            <div class="flex flex-col sm:flex-row gap-2 col-span-1 sm:col-span-2 lg:col-span-4">
                                <button type="submit" id="ingresoSubmitBtn" class="bg-green-600 text-white p-2 rounded-lg font-semibold shadow-md hover:bg-green-700 transition-colors flex-1">Añadir Ingreso</button>
                                <button type="button" id="ingresoCancelBtn" class="hidden bg-gray-500 text-white p-2 rounded-lg font-semibold shadow-md hover:bg-gray-600 transition-colors flex-1">Cancelar Edición</button>
                            </div>
                        </form>
                        <div class="mt-6 flex justify-end">
                            <button id="exportIngresos" class="text-blue-500 hover:underline">Exportar a CSV</button>
                        </div>
                        <div id="ingresosList" class="mt-4 overflow-x-auto"></div>
                    </div>
                    
                    <!-- Gastos -->
                    <div class="bg-white p-6 rounded-2xl shadow-xl">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">Registro de Gastos</h2>
                        <form id="gastoForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="lg:col-span-2">
                                <label for="gastoFecha" class="block text-sm font-semibold text-gray-700">Fecha</label>
                                <input type="date" id="gastoFecha" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-red-300 focus:border-red-500 transition-colors">
                            </div>
                            <div class="lg:col-span-2">
                                <label for="gastoMonto" class="block text-sm font-semibold text-gray-700">Monto</label>
                                <input type="number" id="gastoMonto" placeholder="Ej: 15000" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-red-300 focus:border-red-500 transition-colors">
                            </div>
                            <div>
                                <label for="gastoCategoria" class="block text-sm font-semibold text-gray-700">Categoría</label>
                                <select id="gastoCategoria" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-red-300 focus:border-red-500 transition-colors"></select>
                            </div>
                            <div>
                                <label for="gastoSubcategoria" class="block text-sm font-semibold text-gray-700">Subcategoría</label>
                                <select id="gastoSubcategoria" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-red-300 focus:border-red-500 transition-colors"></select>
                            </div>
                            <div class="lg:col-span-2">
                                <label for="gastoDescripcion" class="block text-sm font-semibold text-gray-700">Descripción</label>
                                <input type="text" id="gastoDescripcion" placeholder="Ej: Cena con amigos" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-red-300 focus:border-red-500 transition-colors">
                            </div>
                            <div class="flex flex-col sm:flex-row gap-2 col-span-1 sm:col-span-2 lg:col-span-4">
                                <button type="submit" id="gastoSubmitBtn" class="bg-red-600 text-white p-2 rounded-lg font-semibold shadow-md hover:bg-red-700 transition-colors flex-1">Añadir Gasto</button>
                                <button type="button" id="gastoCancelBtn" class="hidden bg-gray-500 text-white p-2 rounded-lg font-semibold shadow-md hover:bg-gray-600 transition-colors flex-1">Cancelar Edición</button>
                            </div>
                        </form>
                        <div class="mt-6 flex justify-end">
                            <button id="exportGastos" class="text-blue-500 hover:underline">Exportar a CSV</button>
                        </div>
                        <div id="gastosList" class="mt-4 overflow-x-auto"></div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm text-center space-y-4">
            <p id="modalMessage" class="text-lg font-semibold text-gray-700">¿Estás seguro de que quieres eliminar este registro?</p>
            <div class="flex justify-center space-x-4">
                <button id="cancelBtn" class="py-2 px-6 rounded-lg font-bold bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors">Cancelar</button>
                <button id="confirmBtn" class="py-2 px-6 rounded-lg font-bold bg-red-600 text-white hover:bg-red-700 transition-colors">Confirmar</button>
            </div>
        </div>
    </div>
</body>
</html>
